<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Button Behaviors</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #222;
            color: white;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background: #444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button.active {
            background: #00aa00;
        }
        button:disabled, button[style*="not-allowed"] {
            opacity: 0.5;
            cursor: not-allowed !important;
        }
        .log {
            background: #111;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <h1>Toggle and Fill Button Test</h1>

    <div class="section">
        <h2>Toggle Buttons (Area 1)</h2>
        <div class="button-group">
            <button class="toggle-btn" data-toggle="none">None</button>
            <button class="toggle-btn active" data-toggle="auto">Auto</button>
            <button class="toggle-btn" data-toggle="manual">Manual</button>
        </div>
        <div class="button-group">
            <button class="toggle-btn" data-toggle="stick">Stick</button>
            <button class="toggle-btn active" data-toggle="ride">Ride</button>
            <button class="toggle-btn" data-toggle="lock">Lock</button>
        </div>
    </div>

    <div class="section">
        <h2>Fill Buttons (Area 2)</h2>
        <div class="button-group">
            <button class="fill-btn" data-fill="now">Now</button>
            <button class="fill-btn" data-fill="4">4</button>
            <button class="fill-btn" data-fill="8">8</button>
            <button class="fill-btn active" data-fill="16">16</button>
            <button class="fill-btn" data-fill="32">32</button>
            <button class="fill-btn" data-fill="solo">Solo</button>
        </div>
    </div>

    <div class="section">
        <h2>Test Results</h2>
        <div id="log" class="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');

        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.color = type === 'error' ? '#ff6666' : type === 'success' ? '#66ff66' : '#aaaaaa';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.insertBefore(entry, log.firstChild);
        }

        // State tracking
        const state = {
            toggleStates: {
                none: false,
                auto: true,
                manual: false,
                stick: "stick",
                ride: "ride",
                lock: false
            },
            fillStates: {
                active: "16",
                previousActive: "16",
                now: false,
                solo: false,
                "4": false,
                "8": false,
                "16": true,
                "32": false
            }
        };

        // Toggle button handler
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const toggleType = btn.dataset.toggle;

                // Check if controls are locked
                if (state.toggleStates.lock && toggleType !== 'lock') {
                    addLog(`Controls locked - cannot change ${toggleType}`, 'error');
                    return;
                }

                // Handle Stick/Snare toggle
                if (toggleType === 'stick') {
                    const currentText = btn.textContent;
                    if (currentText === 'Stick') {
                        btn.textContent = 'Snare';
                        btn.classList.add('active');  // Snare is active (white)
                        state.toggleStates.stick = 'snare';
                    } else {
                        btn.textContent = 'Stick';
                        btn.classList.remove('active');  // Stick is normal (not white)
                        state.toggleStates.stick = 'stick';
                    }
                    addLog(`Toggled to ${btn.textContent} (${btn.classList.contains('active') ? 'active' : 'normal'})`, 'success');
                    return;
                }

                // Handle Ride/Hi-Hat toggle
                if (toggleType === 'ride') {
                    const currentText = btn.textContent;
                    if (currentText === 'Ride') {
                        btn.textContent = 'Hi-Hat';
                        btn.classList.remove('active');  // Hi-Hat is normal (not white)
                        state.toggleStates.ride = 'hihat';
                    } else {
                        btn.textContent = 'Ride';
                        btn.classList.add('active');  // Ride is active (white)
                        state.toggleStates.ride = 'ride';
                    }
                    addLog(`Toggled to ${btn.textContent} (${btn.classList.contains('active') ? 'active' : 'normal'})`, 'success');
                    return;
                }

                // Handle Lock button
                if (toggleType === 'lock') {
                    const isActive = btn.classList.contains('active');
                    btn.classList.toggle('active');
                    state.toggleStates.lock = !isActive;

                    const allToggleButtons = document.querySelectorAll('.toggle-btn:not([data-toggle="lock"])');
                    allToggleButtons.forEach(b => {
                        if (!isActive) {
                            b.style.opacity = '0.5';
                            b.style.cursor = 'not-allowed';
                        } else {
                            b.style.opacity = '';
                            b.style.cursor = '';
                        }
                    });

                    addLog(`Lock ${!isActive ? 'enabled' : 'disabled'}`, 'success');
                    return;
                }

                // Handle None/Auto/Manual exclusive buttons
                if (toggleType === 'none' || toggleType === 'auto' || toggleType === 'manual') {
                    ['none', 'auto', 'manual'].forEach(type => {
                        state.toggleStates[type] = false;
                        const b = document.querySelector(`[data-toggle="${type}"]`);
                        if (b) b.classList.remove('active');
                    });

                    state.toggleStates[toggleType] = true;
                    btn.classList.add('active');
                    addLog(`Selected ${toggleType}`, 'success');
                }
            });
        });

        // Fill button handler
        document.querySelectorAll('.fill-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const fillType = btn.dataset.fill;

                // Handle "Now" button toggle
                if (fillType === 'now') {
                    const isActive = btn.classList.contains('active');

                    if (!isActive) {
                        // Deactivate Solo if it's active (mutually exclusive)
                        const soloBtn = document.querySelector('[data-fill="solo"]');
                        if (soloBtn && soloBtn.classList.contains('active')) {
                            soloBtn.classList.remove('active');
                            state.fillStates.solo = false;
                            addLog('Deactivated Solo (mutually exclusive with Now)', 'info');
                        }

                        const currentActiveBtn = document.querySelector('.fill-btn.active:not([data-fill="now"]):not([data-fill="solo"])');
                        if (currentActiveBtn) {
                            state.fillStates.previousActive = currentActiveBtn.dataset.fill;
                            currentActiveBtn.classList.remove('active');
                            state.fillStates[currentActiveBtn.dataset.fill] = false;
                        }

                        btn.classList.add('active');
                        state.fillStates.now = true;
                        state.fillStates.active = 'now';
                        addLog('Now activated, previous fill saved', 'success');
                    } else {
                        btn.classList.remove('active');
                        state.fillStates.now = false;

                        if (state.fillStates.previousActive) {
                            const restoreBtn = document.querySelector(`[data-fill="${state.fillStates.previousActive}"]`);
                            if (restoreBtn) {
                                restoreBtn.classList.add('active');
                                state.fillStates[state.fillStates.previousActive] = true;
                                state.fillStates.active = state.fillStates.previousActive;
                                addLog(`Now deactivated, restored ${state.fillStates.previousActive}`, 'success');
                            }
                        }
                    }
                    return;
                }

                // Handle "Solo" button toggle
                if (fillType === 'solo') {
                    const isActive = btn.classList.contains('active');

                    if (!isActive) {
                        // Deactivate Now if it's active (mutually exclusive)
                        const nowBtn = document.querySelector('[data-fill="now"]');
                        if (nowBtn && nowBtn.classList.contains('active')) {
                            nowBtn.classList.remove('active');
                            state.fillStates.now = false;
                            addLog('Deactivated Now (mutually exclusive with Solo)', 'info');
                        }

                        const currentActiveBtn = document.querySelector('.fill-btn.active:not([data-fill="solo"]):not([data-fill="now"])');
                        if (currentActiveBtn) {
                            state.fillStates.previousActive = currentActiveBtn.dataset.fill;
                            currentActiveBtn.classList.remove('active');
                            state.fillStates[currentActiveBtn.dataset.fill] = false;
                        }

                        btn.classList.add('active');
                        state.fillStates.solo = true;
                        state.fillStates.active = 'solo';
                        addLog('Solo activated, previous fill saved', 'success');
                    } else {
                        btn.classList.remove('active');
                        state.fillStates.solo = false;

                        if (state.fillStates.previousActive) {
                            const restoreBtn = document.querySelector(`[data-fill="${state.fillStates.previousActive}"]`);
                            if (restoreBtn) {
                                restoreBtn.classList.add('active');
                                state.fillStates[state.fillStates.previousActive] = true;
                                state.fillStates.active = state.fillStates.previousActive;
                                addLog(`Solo deactivated, restored ${state.fillStates.previousActive}`, 'success');
                            }
                        }
                    }
                    return;
                }

                // Handle regular fill buttons (4, 8, 16, 32) - mutually exclusive
                document.querySelectorAll('.fill-btn').forEach(b => {
                    b.classList.remove('active');
                    const btnFill = b.dataset.fill;
                    state.fillStates[btnFill] = false;
                });

                btn.classList.add('active');
                state.fillStates[fillType] = true;
                state.fillStates.active = fillType;
                state.fillStates.previousActive = fillType;
                addLog(`Fill ${fillType} selected`, 'success');
            });
        });

        addLog('Test page loaded - try clicking buttons to test behaviors');
    </script>
</body>
</html>